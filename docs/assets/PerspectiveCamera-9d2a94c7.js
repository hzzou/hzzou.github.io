import{_ as R}from"./extends-4c19d496.js";import{r as t}from"./index-e86d0381.js";import{ay as T,p as F,az as v,aA as x,aB as h}from"./three.module-e72dd0cd.js";import{b as p,u as L}from"./OrbitControls-4f76d3ed.js";function w(n,g,d){const f=p(r=>r.size),c=p(r=>r.viewport),a=typeof n=="number"?n:f.width*c.dpr,u=typeof g=="number"?g:f.height*c.dpr,l=(typeof n=="number"?d:n)||{},{samples:i=0,depth:m,...s}=l,o=t.useMemo(()=>{const r=new T(a,u,{minFilter:F,magFilter:F,type:v,...s});return m&&(r.depthTexture=new x(a,u,h)),r.samples=i,r},[]);return t.useLayoutEffect(()=>{o.setSize(a,u),i&&(o.samples=i)},[i,o,a,u]),t.useEffect(()=>()=>o.dispose(),[]),o}const z=n=>typeof n=="function",k=t.forwardRef(({envMap:n,resolution:g=256,frames:d=1/0,makeDefault:f,children:c,...a},u)=>{const l=p(({set:e})=>e),i=p(({camera:e})=>e),m=p(({size:e})=>e),s=t.useRef(null);t.useImperativeHandle(u,()=>s.current,[]);const o=t.useRef(null),r=w(g);t.useLayoutEffect(()=>{a.manual||(s.current.aspect=m.width/m.height)},[m,a]),t.useLayoutEffect(()=>{s.current.updateProjectionMatrix()});let b=0,E=null;const y=z(c);return L(e=>{y&&(d===1/0||b<d)&&(o.current.visible=!1,e.gl.setRenderTarget(r),E=e.scene.background,n&&(e.scene.background=n),e.gl.render(e.scene,s.current),e.scene.background=E,e.gl.setRenderTarget(null),o.current.visible=!0,b++)}),t.useLayoutEffect(()=>{if(f){const e=i;return l(()=>({camera:s.current})),()=>l(()=>({camera:e}))}},[s,f,l]),t.createElement(t.Fragment,null,t.createElement("perspectiveCamera",R({ref:s},a),!y&&c),t.createElement("group",{ref:o},y&&c(r.texture)))});export{k as P};
