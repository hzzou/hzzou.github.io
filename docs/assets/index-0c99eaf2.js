import{r as y,j as l}from"./index-e86d0381.js";import{a as B,C as te,O as se,b as re,u as ne}from"./OrbitControls-4f76d3ed.js";import{V as R,l as q,ao as z,a8 as ae,aa as oe,X as ie,ap as le,Q as ce,y as ue,v as A,m as O,k as me,aq as fe,ar as de,B as pe,r as he,as as ge,d as xe,H as ye,at as Me}from"./three.module-e72dd0cd.js";import{u as T}from"./Gltf-725507a2.js";import{P as we}from"./PerspectiveCamera-9d2a94c7.js";import{_ as F}from"./extends-4c19d496.js";function G(t,s,e={}){const n=new R,h=new ce,m=new R,c=new q,p=new q,M=new q;e.preserveMatrix=e.preserveMatrix!==void 0?e.preserveMatrix:!0,e.preservePosition=e.preservePosition!==void 0?e.preservePosition:!0,e.preserveHipPosition=e.preserveHipPosition!==void 0?e.preserveHipPosition:!1,e.useTargetMatrix=e.useTargetMatrix!==void 0?e.useTargetMatrix:!1,e.hip=e.hip!==void 0?e.hip:"hip",e.names=e.names||{};const b=s.isObject3D?s.skeleton.bones:D(s),x=t.isObject3D?t.skeleton.bones:D(t);let w,a,i,d,g;if(t.isObject3D?t.skeleton.pose():(e.useTargetMatrix=!0,e.preserveMatrix=!1),e.preservePosition){g=[];for(let u=0;u<x.length;u++)g.push(x[u].position.clone())}if(e.preserveMatrix){t.updateMatrixWorld(),t.matrixWorld.identity();for(let u=0;u<t.children.length;++u)t.children[u].updateMatrixWorld(!0)}if(e.offsets){w=[];for(let u=0;u<x.length;++u)a=x[u],i=e.names[a.name]||a.name,e.offsets[i]&&(a.matrix.multiply(e.offsets[i]),a.matrix.decompose(a.position,a.quaternion,a.scale),a.updateMatrixWorld()),w.push(a.matrixWorld.clone())}for(let u=0;u<x.length;++u){if(a=x[u],i=e.names[a.name]||a.name,d=H(i,b),M.copy(a.matrixWorld),d){if(d.updateMatrixWorld(),e.useTargetMatrix?p.copy(d.matrixWorld):(p.copy(t.matrixWorld).invert(),p.multiply(d.matrixWorld)),m.setFromMatrixScale(p),p.scale(m.set(1/m.x,1/m.y,1/m.z)),M.makeRotationFromQuaternion(h.setFromRotationMatrix(p)),t.isObject3D){const k=x.indexOf(a),L=w?w[k]:c.copy(t.skeleton.boneInverses[k]).invert();M.multiply(L)}M.copyPosition(p)}a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(M)):a.matrix.copy(M),e.preserveHipPosition&&i===e.hip&&a.matrix.setPosition(n.set(0,a.position.y,0)),a.matrix.decompose(a.position,a.quaternion,a.scale),a.updateMatrixWorld()}if(e.preservePosition)for(let u=0;u<x.length;++u)a=x[u],i=e.names[a.name]||a.name,i!==e.hip&&a.position.copy(g[u]);e.preserveMatrix&&t.updateMatrixWorld(!0)}function ve(t,s,e,n={}){n.useFirstFramePosition=n.useFirstFramePosition!==void 0?n.useFirstFramePosition:!1,n.fps=n.fps!==void 0?n.fps:30,n.names=n.names||[],s.isObject3D||(s=ke(s));const h=Math.round(e.duration*(n.fps/1e3)*1e3),m=1/n.fps,c=[],p=new z(s),M=D(t.skeleton),b=[];let x,w,a,i,d;p.clipAction(e).play(),p.update(0),s.updateMatrixWorld();for(let g=0;g<h;++g){const u=g*m;G(t,s,n);for(let k=0;k<M.length;++k)d=n.names[M[k].name]||M[k].name,a=H(d,s.skeleton),a&&(w=M[k],i=b[k]=b[k]||{bone:w},n.hip===d&&(i.pos||(i.pos={times:new Float32Array(h),values:new Float32Array(h*3)}),n.useFirstFramePosition&&(g===0&&(x=w.position.clone()),w.position.sub(x)),i.pos.times[g]=u,w.position.toArray(i.pos.values,g*3)),i.quat||(i.quat={times:new Float32Array(h),values:new Float32Array(h*4)}),i.quat.times[g]=u,w.quaternion.toArray(i.quat.values,g*4));p.update(m),s.updateMatrixWorld()}for(let g=0;g<b.length;++g)i=b[g],i&&(i.pos&&c.push(new ae(".bones["+i.bone.name+"].position",i.pos.times,i.pos.values)),c.push(new oe(".bones["+i.bone.name+"].quaternion",i.quat.times,i.quat.values)));return p.uncacheAction(e),new ie(e.name,-1,c)}function be(t){const s=new Map,e=new Map,n=t.clone();return K(t,n,function(h,m){s.set(m,h),e.set(h,m)}),n.traverse(function(h){if(!h.isSkinnedMesh)return;const m=h,c=s.get(h),p=c.skeleton.bones;m.skeleton=c.skeleton.clone(),m.bindMatrix.copy(c.bindMatrix),m.skeleton.bones=p.map(function(M){return e.get(M)}),m.bind(m.skeleton,m.bindMatrix)}),n}function H(t,s){for(let e=0,n=D(s);e<n.length;e++)if(t===n[e].name)return n[e]}function D(t){return Array.isArray(t)?t:t.bones}function ke(t){const s=new le(t.bones[0]);return s.skeleton=t,s}function K(t,s,e){e(t,s);for(let n=0;n<t.children.length;n++)K(t.children[n],s.children[n],e)}const je={retarget:G,retargetClip:ve,clone:be};function Ae(t,{keys:s=["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData","bindMode","bindMatrix","bindMatrixInverse","skeleton"],deep:e,inject:n,castShadow:h,receiveShadow:m}){let c={};for(const p of s)c[p]=t[p];return e&&(c.geometry&&e!=="materialsOnly"&&(c.geometry=c.geometry.clone()),c.material&&e!=="geometriesOnly"&&(c.material=c.material.clone())),n&&(typeof n=="function"?c={...c,children:n(t)}:y.isValidElement(n)?c={...c,children:n}:c={...c,...n}),t instanceof ue&&(h&&(c.castShadow=!0),m&&(c.receiveShadow=!0)),c}const E=y.forwardRef(({isChild:t=!1,object:s,children:e,deep:n,castShadow:h,receiveShadow:m,inject:c,keys:p,...M},b)=>{const x={keys:p,deep:n,inject:c,castShadow:h,receiveShadow:m};if(s=y.useMemo(()=>{if(t===!1&&!Array.isArray(s)){let d=!1;if(s.traverse(g=>{g.isSkinnedMesh&&(d=!0)}),d)return je.clone(s)}return s},[s,t]),Array.isArray(s))return y.createElement("group",F({},M,{ref:b}),s.map(d=>y.createElement(E,F({key:d.uuid,object:d},x))),e);const{children:w,...a}=Ae(s,x),i=s.type[0].toLowerCase()+s.type.slice(1);return y.createElement(i,F({},a,M,{ref:b}),s.children.map(d=>d.type==="Bone"?y.createElement("primitive",F({key:d.uuid,object:d},x)):y.createElement(E,F({key:d.uuid,object:d},x,{isChild:!0}))),e,w)}),Se="olympic-hall-",Pe={olympic:Se};var Te=function(t){y.useEffect(t,[])};const Q=Te;var Fe=function(t){Q(function(){t()})};const We=Fe;var Be=function(t){var s=y.useRef(t);s.current=t,Q(function(){return function(){return s.current()}})};const Oe=Be,Re=()=>{const t=new Me,[s,e]=y.useState(0);We(()=>{console.log("组件挂载"),console.log(performance.now())}),Oe(()=>{console.log("组件卸载"),console.log(performance.now())});const n=()=>{const{scene:o,camera:r,clock:v}=re(),j=B(O,"/textures/oly/sky.jpg");return o.background=j,r.lookAt(0,0,0),ne(f=>{f.clock.elapsedTime<6&&(f.camera.position.z=300,f.clock.elapsedTime<=5.3?f.camera.position.z-=f.clock.elapsedTime*40:f.camera.position.z=88)}),null},h=T("/models/land.glb"),[m,c]=y.useState({}),p=T("/models/flag.glb"),M=B(O,"/textures/oly/flag.png"),[b,x]=y.useState({});let w;const a=T("/models/bingdwendwen.glb"),[i,d]=y.useState({}),g=T("/models/xuerongrong.glb"),[u,k]=y.useState({}),L=T("/models/tree.gltf"),C=B(O,"/textures/oly/tree.png"),[W,U]=y.useState([]),V=B(O,"/textures/oly/snow.png"),[S,_]=y.useState({}),$=()=>{const o=h.scene;o.scale.set(1.5,1.5,1.5),o.position.set(-35,-40,0),o.rotation.set(0,-Math.PI/4,0),o.traverse(r=>{r.type==="Mesh"&&(r.receiveShadow=!0,r.material.metalness=.1,r.material.roughness=.8)}),c(o)},J=()=>{const o=p.scene;o.traverse(f=>{f.type==="Mesh"&&(f.castShadow=!0,f.name==="mesh_0001"&&(f.material.metalness=.1,f.material.roughness=.1,f.material.map=M),f.name==="柱体"&&(f.material.metalness=.6,f.material.roughness=0,f.material.refractionRatio=1))}),o.rotation.set(0,0,0),o.position.set(10,0,45),o.scale.set(10,10,10);const r=p.animations[0];w=new z(o);let v=r;v=w.clipAction(v).play().getClip(),x(o)},X=()=>{const o=a.scene;o.traverse(r=>{r.type==="Mesh"&&(r.castShadow=!0,r.name==="皮肤"&&(r.material.metalness=.3,r.material.roughness=.8),r.name==="外壳"&&(r.material.transparent=!0,r.material.opacity=.15,r.material.metalness=.6,r.material.roughness=.8,r.material.refractionRatio=1.2,r.castShadow=!0),r.name==="围脖"&&(r.material.transparent=!0,r.material.opacity=.6,r.material.metalness=.4,r.material.roughness=.6))}),o.rotation.set(0,-Math.PI/24,0),o.position.set(-7,-22,54),o.scale.set(44,44,44),d(o)},N=()=>{const o=g.scene;o.traverse(r=>{r.type==="Mesh"&&(r.castShadow=!0)}),o.rotation.set(0,Math.PI/3,0),o.position.set(-30,-18,60),o.scale.set(18,18,18),k(o)},Y=()=>{const o=L.scene;o.traverse(f=>{if(f.type==="Mesh"){f.castShadow=!0;const P=new me({map:C,transparent:!0,side:A,metalness:.8,roughness:0,depthTest:!0,depthWrite:!1,fog:!1,reflectivity:.1}),ee=new fe({depthPacking:de,map:C});f.material=P,f.custromMaterial=ee}});const r=o.clone();r.position.set(-15,-10,50),r.scale.set(30,30,30);const v=o.clone();v.position.set(15,-15,40),v.scale.set(25,25,25);const j=o.clone();j.position.set(35,-20,55),j.scale.set(30,30,30),U([r,v,j])},Z=()=>{const o=new pe,r=new he({size:1,transparent:!0,opacity:.8,map:V,blending:ge,sizeAttenuation:!0,depthTest:!1}),v=100,j=new Float32Array(1500*3);for(let P=0;P<1500;P++)j[P]=Math.random()*v-v/2;o.center(),o.setAttribute("position",new xe(j,3));const f=new ye(o,r);_(f)},I=()=>{const o=t.getDelta();if(w&&w.update(o),JSON.stringify(S)!=="{}"){const r=S.geometry.getAttribute("position");for(let v=0;v<r.array.length;v+=3)r.array[v+1]-=.3,r.array[v+1]<-30&&(r.array[v+1]=30);S.geometry.attributes.position.needsUpdate=!0}if(s<360){const r=t.elapsedTime*.1;e(r)}else e(0);requestAnimationFrame(I)};return y.useEffect(()=>(console.log("组件挂载"),console.log(performance.now()),$(),Y(),J(),X(),N(),Z(),()=>{console.log("组件卸载1"),console.log(performance.now())}),[]),y.useEffect(()=>(I(),()=>{console.log("不是组件卸载"),console.log(performance.now())}),[b,i,u,W,S]),l.jsx("div",{id:Pe.olympic,children:l.jsxs(te,{shadows:!0,children:[l.jsx(we,{fov:60,near:20,far:500,aspect:window.innerWidth/window.innerHeight,position:[0,0,200]}),l.jsx(se,{minAzimuthAngle:-Math.PI/6,maxAzimuthAngle:Math.PI/6,minPolarAngle:Math.PI/2*8/9,maxPolarAngle:Math.PI/2,maxDistance:110,minDistance:88}),l.jsx(n,{}),l.jsx("ambientLight",{intensity:1,args:["#cfffff"]}),l.jsx("directionalLight",{intensity:1,position:[0,80,200],castShadow:!0,"shadow-camera-top":70,"shadow-camera-bottom":-70,"shadow-camera-left":70,"shadow-camera-right":-70}),l.jsxs("group",{children:[l.jsx("primitive",{object:m}),l.jsx("primitive",{object:S}),l.jsx("primitive",{object:b}),l.jsx("primitive",{object:i}),l.jsx("primitive",{object:u}),l.jsx("primitive",{object:W[0]}),l.jsx(E,{object:W[1]}),l.jsx(E,{object:W[2]}),l.jsxs("group",{position:[0,2,65],"rotation-y":s,children:[l.jsxs("mesh",{castShadow:!0,position:[-10,10,0],children:[l.jsx("torusGeometry",{args:[6,.4,10]}),l.jsx("meshLambertMaterial",{color:"#0885c2",side:A})]}),l.jsxs("mesh",{castShadow:!0,position:[5,10,0],children:[l.jsx("torusGeometry",{args:[6,.4,10]}),l.jsx("meshLambertMaterial",{color:"#000",side:A})]}),l.jsxs("mesh",{castShadow:!0,position:[20,10,0],children:[l.jsx("torusGeometry",{args:[6,.4,10]}),l.jsx("meshLambertMaterial",{color:"#ed334e",side:A})]}),l.jsxs("mesh",{castShadow:!0,position:[-2.5,4,.5],children:[l.jsx("torusGeometry",{args:[6,.4,10]}),l.jsx("meshLambertMaterial",{color:"#fbb132",side:A})]}),l.jsxs("mesh",{castShadow:!0,position:[12,4,.5],children:[l.jsx("torusGeometry",{args:[6,.4,10]}),l.jsx("meshLambertMaterial",{color:"#1c8b3c",side:A})]})]})]})]})})};export{Re as default};
