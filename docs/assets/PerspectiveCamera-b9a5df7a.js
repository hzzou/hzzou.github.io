import{_ as R}from"./extends-98964cd2.js";import{r as t}from"./index-7e0aa793.js";import{b as p,u as T,m as v}from"./OrbitControls-34aabd97.js";import{at as x,_ as F,au as h,av as w,aw as L}from"./three.module-d13e5444.js";function _(n,g,d){const f=p(r=>r.size),c=p(r=>r.viewport),o=typeof n=="number"?n:f.width*c.dpr,u=typeof g=="number"?g:f.height*c.dpr,l=(typeof n=="number"?d:n)||{},{samples:i=0,depth:m,...a}=l,s=t.useMemo(()=>{const r=new x(o,u,{minFilter:F,magFilter:F,type:h,...a});return m&&(r.depthTexture=new w(o,u,L)),r.samples=i,r},[]);return t.useLayoutEffect(()=>{s.setSize(o,u),i&&(s.samples=i)},[i,s,o,u]),t.useEffect(()=>()=>s.dispose(),[]),s}const z=n=>typeof n=="function",M=t.forwardRef(({envMap:n,resolution:g=256,frames:d=1/0,makeDefault:f,children:c,...o},u)=>{const l=p(({set:e})=>e),i=p(({camera:e})=>e),m=p(({size:e})=>e),a=t.useRef(null),s=t.useRef(null),r=_(g);t.useLayoutEffect(()=>{o.manual||(a.current.aspect=m.width/m.height)},[m,o]),t.useLayoutEffect(()=>{a.current.updateProjectionMatrix()});let b=0,E=null;const y=z(c);return T(e=>{y&&(d===1/0||b<d)&&(s.current.visible=!1,e.gl.setRenderTarget(r),E=e.scene.background,n&&(e.scene.background=n),e.gl.render(e.scene,a.current),e.scene.background=E,e.gl.setRenderTarget(null),s.current.visible=!0,b++)}),t.useLayoutEffect(()=>{if(f){const e=i;return l(()=>({camera:a.current})),()=>l(()=>({camera:e}))}},[a,f,l]),t.createElement(t.Fragment,null,t.createElement("perspectiveCamera",R({ref:v([a,u])},o),!y&&c),t.createElement("group",{ref:s},y&&c(r.texture)))});export{M as P};
